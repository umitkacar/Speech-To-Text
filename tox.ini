# Tox configuration for testing across multiple Python versions
# Run: tox

[tox]
env_list =
    py38
    py39
    py310
    py311
    py312
    lint
    type
    coverage

min_version = 4.0
isolated_build = true

[testenv]
description = Run tests with pytest
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.12.0
    pytest-xdist>=3.5.0
commands =
    pytest {posargs:tests}

[testenv:coverage]
description = Run tests with coverage report
deps =
    {[testenv]deps}
commands =
    pytest --cov=src/speech_to_text_ai \
           --cov-report=term-missing \
           --cov-report=html \
           --cov-report=xml \
           --cov-fail-under=80 \
           {posargs:tests}

[testenv:lint]
description = Run linters (ruff + black)
skip_install = true
deps =
    ruff>=0.1.9
    black>=23.12.0
commands =
    ruff check src/ tests/
    black --check --diff src/ tests/

[testenv:type]
description = Run type checking with mypy
deps =
    mypy>=1.8.0
    types-all
commands =
    mypy --install-types --non-interactive src/

[testenv:format]
description = Format code with black and ruff
skip_install = true
deps =
    black>=23.12.0
    ruff>=0.1.9
commands =
    black src/ tests/
    ruff check --fix src/ tests/

[testenv:security]
description = Security checks with bandit
skip_install = true
deps =
    bandit[toml]>=1.7.0
commands =
    bandit -r src/ -c pyproject.toml

[testenv:docs]
description = Build documentation (placeholder for future)
skip_install = true
deps =
    sphinx>=7.0.0
    sphinx-rtd-theme>=2.0.0
commands =
    echo "Documentation build not yet configured"

[testenv:clean]
description = Clean up build artifacts
skip_install = true
allowlist_externals =
    rm
    find
commands =
    rm -rf build/ dist/ *.egg-info .pytest_cache/ .mypy_cache/ .ruff_cache/ htmlcov/
    find . -type d -name __pycache__ -exec rm -rf {{}} +
